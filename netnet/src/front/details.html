<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="movieTitle">Movie - Netnet</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="header-container"></div>
    <main>
        <a href="home.html" class="back-link">← Retour à la page d'accueil</a>
        <div class="details-container" id="detailsContainer">
            <div class="details-movie">
                <img id="detailMovie" src="image1.png" alt="Movie details">
            </div>
            <div class="details-info">
                <h2 id="detailTitle">Movie Title</h2>
                <p></p>
                
                <div class="detail-field">
                    <label>Date de publication</label>
                    <p id="publishedAtInfo">-</p>
                </div>
                
                <div class="detail-field">
                    <label>Synopsis</label>
                    <p id="synopsisInfo">Aucun synopsis disponible.</p>
                </div>
                
                <div class="detail-field">
                    <button id="trailerInfo" class="trailer-btn" style="display: none;">Regarder le trailer</button>
                </div>
            
                <div id="message" style="margin-top: 20px;"></div>
                
                <div class="detail-field">
                    <a href="update.html?id=" id="updateLink" class="update-btn">Modifier ce film</a>
                    <button type="delete" id="deleteLink" class="delete-btn">Supprimer ce film</button>
                </div>
            
            </div>
        </div>
    </main>
    <script>
        // Header
        async function loadHeader() {
            try {
                const response = await fetch('/header.html');
                const headerHTML = await response.text();
                document.getElementById('header-container').innerHTML = headerHTML;
            } catch (error) {
                console.error('Error loading header:', error);
            }
        }
        
        // Récupération de l'ID du film
        const params = new URLSearchParams(window.location.search);
        const filmId = params.get('id');

        // Fonction async pour modifier les données avec celles récupérées dans la BDD
        async function loadFilmDetails() {
            if (!filmId) {
                console.error('No film ID provided');
                return;
            }
            
            try {
                const response = await fetch(`/api/films/${filmId}`);
                if (!response.ok) {
                    throw new Error('Film not found');
                }
                const film = await response.json();
                
                // Mise à jour de la partie html
                document.getElementById('detailMovie').src = film.thumbnailUrl;
                document.getElementById('movieTitle').textContent = film.title + ' - Netnet';
                document.getElementById('detailMovie').alt = film.title;
                document.getElementById('detailTitle').textContent = film.title;
                document.getElementById('synopsisInfo').textContent = film.synopsis || 'No synopsis available.';
                document.getElementById('publishedAtInfo').textContent = new Date(film.publishedAt).toLocaleDateString() || '-';
                document.getElementById('updateLink').href = `update.html?id=${filmId}`;
                if (film.trailerUrl) {
                    const trailerBtn = document.getElementById('trailerInfo');
                    trailerBtn.style.display = 'block';
                    trailerBtn.onclick = () => window.open(film.trailerUrl, '_blank');
                }
            } catch (error) {
                console.error('Error loading film details:', error);
                document.getElementById('detailTitle').textContent = 'Film not found';
            }
        }

        // Bouton de suppression
        document.getElementById('deleteLink').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                let response;
                const movieId = params.get('id');
                if (movieId) {
                    response = await fetch(`/api/films/${movieId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    if (!response.ok) throw new Error('Erreur lors de la suppression');
                    showMessage('Film supprimé !', 'success');
                    setTimeout(() => window.location.href = 'home.html', 1500);
                }
            } catch (error) {
                console.error('Error deleting movie :', error);
                showMessage('Error deleting movie : ' + error.message, 'error');
            }
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.style.color = type === 'success' ? 'green' : 'red';
        }
        

        // Chargement de la fonction async
        document.addEventListener('DOMContentLoaded', () => {
            loadHeader();
            loadFilmDetails();
        });
    </script>
</body>
</html>
